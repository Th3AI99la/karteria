<!doctype html>
<html lang="pt-br" xmlns:th="http://www.thymeleaf.org">
    <head>
        <meta charset="UTF-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />
        <title>Configurações - Karteria</title>

        <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" />
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css" />
        <link rel="stylesheet" th:href="@{/css/karteria-colors.css}" />
        <link rel="stylesheet" th:href="@{/css/karteria-main.css}" />
        <link rel="stylesheet" th:href="@{/css/fragments/_navbar_dashboard.css}" />
        <link rel="stylesheet" th:href="@{/css/fragments/_notification_dropdown.css}" />
        <link rel="stylesheet" th:href="@{/css/pages/seguranca.css}" />
        <link href="https://unpkg.com/aos@2.3.1/dist/aos.css" rel="stylesheet" />
    </head>

    <body class="dashboard-layout">
        <div th:replace="~{_navbar_dashboard :: dashboard_nav}"></div>
        <div th:replace="~{_navbar_dashboard :: global_loader}"></div>

        <main class="dashboard-content">
            <div class="container settings-container py-4">
                <div class="dashboard-header mb-4">
                    <h1>
                        Configurações e
                        <span class="brand-text">Privacidade</span>
                    </h1>
                </div>

                <div th:if="${sucesso}" class="alert alert-success animate-fade-in-down" th:text="${sucesso}"></div>
                <div th:if="${sucessoDados}" class="alert alert-success animate-fade-in-down" th:text="${sucessoDados}"></div>
                <div th:if="${erroDados}" class="alert alert-danger animate-fade-in-down" th:text="${erroDados}"></div>
                <div th:if="${erroSenha}" class="alert alert-danger animate-fade-in-down" th:text="${erroSenha}"></div>

                <h2 class="settings-section-title">Preferências gerais</h2>
                <div class="settings-card" data-aos="fade-up">
                    <div class="settings-item" data-bs-toggle="modal" data-bs-target="#modalIdioma">
                        <div class="item-content">
                            <h3>Idioma</h3>
                            <p>Selecione o idioma de exibição da plataforma.</p>
                        </div>
                        <i class="fas fa-chevron-right item-arrow"></i>
                    </div>

                    <div class="settings-item" data-bs-toggle="modal" data-bs-target="#modalExibicao">
                        <div class="item-content">
                            <h3>Exibição</h3>
                            <p>Modo escuro, claro ou configuração do dispositivo.</p>
                        </div>
                        <i class="fas fa-chevron-right item-arrow"></i>
                    </div>
                </div>

                <h2 class="settings-section-title">Acesso e segurança</h2>
                <div class="settings-card" data-aos="fade-up" data-aos-delay="100">
                    <div class="settings-item" data-bs-toggle="modal" data-bs-target="#modalEmail">
                        <div class="item-content">
                            <h3>Endereços de e-mail</h3>
                            <p th:text="${usuario.email}">usuario@email.com</p>
                        </div>
                        <i class="fas fa-chevron-right item-arrow"></i>
                    </div>

                    <div class="settings-item" data-bs-toggle="modal" data-bs-target="#modalSenha">
                        <div class="item-content">
                            <h3>Alterar senha</h3>
                            <p>Crie uma senha forte para proteger sua conta.</p>
                        </div>
                        <i class="fas fa-chevron-right item-arrow"></i>
                    </div>
                </div>

                <h2 class="settings-section-title">Gerenciamento da conta</h2>
                <div class="settings-card" data-aos="fade-up" data-aos-delay="200">
                    <div class="settings-item" data-bs-toggle="modal" data-bs-target="#modalHibernar">
                        <div class="item-content">
                            <h3>Colocar conta em hibernação</h3>
                            <p>Desative temporariamente sua conta e oculte seu perfil.</p>
                        </div>
                        <i class="fas fa-chevron-right item-arrow"></i>
                    </div>

                    <div class="settings-item" data-bs-toggle="modal" data-bs-target="#modalEncerrar">
                        <div class="item-content">
                            <h3 class="text-danger">Encerrar e excluir conta</h3>
                            <p>Exclua permanentemente sua conta e seus dados.</p>
                        </div>
                        <i class="fas fa-chevron-right item-arrow"></i>
                    </div>
                </div>
            </div>
        </main>

        <div class="modal fade" id="modalExibicao" tabindex="-1" aria-hidden="true">
            <div class="modal-dialog modal-dialog-centered">
                <div class="modal-content">
                    <div class="modal-header border-0 pb-0">
                        <h5 class="modal-title fw-bold">Exibição</h5>
                        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                    </div>
                    <div class="modal-body">
                        <p class="text-muted mb-4">Selecione como o Karteria será exibido neste dispositivo.</p>

                        <div class="option-list">
                            <div class="option-item">
                                <input type="radio" name="themeOptions" id="themeDevice" value="auto" />
                                <label for="themeDevice" class="option-label">Configurações do dispositivo</label>
                            </div>
                            <div class="option-item">
                                <input type="radio" name="themeOptions" id="themeDark" value="dark" />
                                <label for="themeDark" class="option-label">Modo escuro (Sempre ativado)</label>
                            </div>
                            <div class="option-item">
                                <input type="radio" name="themeOptions" id="themeLight" value="light" />
                                <label for="themeLight" class="option-label">Modo claro (Sempre desativado)</label>
                            </div>
                        </div>
                    </div>
                    <div class="modal-footer border-0">
                        <button type="button" class="btn btn-primary-karteria" id="btnSalvarTema" data-bs-dismiss="modal">Aplicar</button>
                    </div>
                </div>
            </div>
        </div>

        <div class="modal fade" id="modalIdioma" tabindex="-1" aria-hidden="true">
            <div class="modal-dialog modal-dialog-centered">
                <div class="modal-content">
                    <div class="modal-header border-0">
                        <h5 class="modal-title fw-bold">Idioma</h5>
                        <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                    </div>
                    <div class="modal-body">
                        <div class="option-list">
                            <div class="option-item">
                                <input type="radio" name="langOptions" id="langPT" value="pt" checked />
                                <label for="langPT" class="option-label">Português (Brasil)</label>
                            </div>
                            <div class="option-item">
                                <input type="radio" name="langOptions" id="langEN" value="en" />
                                <label for="langEN" class="option-label">English</label>
                            </div>
                        </div>
                    </div>
                    <div class="modal-footer border-0">
                        <button type="button" class="btn btn-primary-karteria" data-bs-dismiss="modal">Salvar</button>
                    </div>
                </div>
            </div>
        </div>

        <div class="modal fade" id="modalEmail" tabindex="-1" aria-hidden="true">
            <div class="modal-dialog modal-dialog-centered">
                <div class="modal-content">
                    <form th:action="@{/seguranca/atualizar-dados}" method="post">
                        <div class="modal-header border-0">
                            <h5 class="modal-title fw-bold">Alterar E-mail</h5>
                            <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                        </div>
                        <div class="modal-body">
                            <p class="text-muted small">Seu e-mail atual é usado para login e notificações.</p>
                            <div class="mb-3">
                                <label for="newEmail" class="form-label">Novo E-mail</label>
                                <input type="email" class="form-control" id="newEmail" name="email" th:value="${usuario.email}" required />
                            </div>
                            <input type="hidden" name="telefone" th:value="${usuario.telefone}" />
                        </div>
                        <div class="modal-footer border-0">
                            <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancelar</button>
                            <button type="submit" class="btn btn-primary-karteria">Salvar Alteração</button>
                        </div>
                    </form>
                </div>
            </div>
        </div>

        <div class="modal fade" id="modalSenha" tabindex="-1" aria-hidden="true">
            <div class="modal-dialog modal-dialog-centered">
                <div class="modal-content">
                    <form th:action="@{/seguranca/alterar-senha}" method="post">
                        <div class="modal-header border-0">
                            <h5 class="modal-title fw-bold">Alterar Senha</h5>
                            <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                        </div>
                        <div class="modal-body">
                            <div class="mb-3">
                                <label for="senhaAtual" class="form-label">Senha Atual</label>
                                <input type="password" class="form-control" id="senhaAtual" name="senhaAtual" required />
                            </div>
                            <div class="mb-3">
                                <label for="novaSenha" class="form-label">Nova Senha</label>
                                <input type="password" class="form-control" id="novaSenha" name="novaSenha" minlength="6" required />
                            </div>
                            <div class="mb-3">
                                <label for="confirmarSenha" class="form-label">Confirmar Nova Senha</label>
                                <input type="password" class="form-control" id="confirmarSenha" name="confirmarSenha" required />
                            </div>
                        </div>
                        <div class="modal-footer border-0">
                            <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancelar</button>
                            <button type="submit" class="btn btn-primary-karteria">Alterar Senha</button>
                        </div>
                    </form>
                </div>
            </div>
        </div>

        <div class="modal fade" id="modalHibernar" tabindex="-1" aria-hidden="true">
            <div class="modal-dialog modal-dialog-centered">
                <div class="modal-content">
                    <div class="modal-header border-0">
                        <h5 class="modal-title fw-bold">Hibernar Conta</h5>
                        <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                    </div>
                    <div class="modal-body">
                        <p>
                            Ao hibernar sua conta, seus anúncios e perfil ficarão invisíveis para outros usuários, mas seus dados serão mantidos. Você pode reativar a qualquer
                            momento fazendo login novamente.
                        </p>
                        <p class="fw-bold">Deseja continuar?</p>
                    </div>
                    <div class="modal-footer border-0">
                        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancelar</button>
                        <a href="#" class="btn btn-warning">Sim, Hibernar</a>
                    </div>
                </div>
            </div>
        </div>

        <div class="modal fade" id="modalEncerrar" tabindex="-1" aria-hidden="true">
            <div class="modal-dialog modal-dialog-centered">
                <div class="modal-content">
                    <div class="modal-header border-0">
                        <h5 class="modal-title fw-bold text-danger">Encerrar Conta</h5>
                        <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                    </div>
                    <div class="modal-body">
                        <div class="alert alert-danger">
                            <i class="fas fa-exclamation-triangle me-2"></i>
                            <strong>Ação irreversível</strong>
                        </div>
                        <p>Ao encerrar sua conta:</p>
                        <ul>
                            <li>Todos os seus anúncios serão apagados.</li>
                            <li>Seu histórico de candidaturas será perdido.</li>
                            <li>Você perderá o acesso permanentemente.</li>
                        </ul>
                        <p>Para confirmar, digite sua senha:</p>
                        <input type="password" class="form-control" placeholder="Sua senha" />
                    </div>
                    <div class="modal-footer border-0">
                        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancelar</button>
                        <button type="button" class="btn btn-danger">Encerrar permanentemente</button>
                    </div>
                </div>
            </div>
        </div>

        <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
        <script src="https://unpkg.com/aos@2.3.1/dist/aos.js"></script>
        <script th:src="@{/js/karteria-main.js}"></script>
        <script th:src="@{/js/karteria-forms.js}"></script>
        <script th:src="@{/js/notification-dropdown.js}"></script>
        <script>
            AOS.init({ once: true, duration: 600 });

            // --- Lógica do Tema (Exibição) ---
            document.addEventListener("DOMContentLoaded", () => {
                // 1. Verifica tema atual
                const currentTheme = localStorage.getItem("karteria-theme") || "auto";

                // 2. Marca o radio correto
                if (currentTheme === "dark") document.getElementById("themeDark").checked = true;
                else if (currentTheme === "light") document.getElementById("themeLight").checked = true;
                else document.getElementById("themeDevice").checked = true;

                // 3. Salvar e Aplicar
                document.getElementById("btnSalvarTema").addEventListener("click", () => {
                    let selectedTheme = "light";
                    if (document.getElementById("themeDark").checked) selectedTheme = "dark";
                    else if (document.getElementById("themeDevice").checked) {
                        // Se for device, verifica a preferência do sistema
                        selectedTheme = window.matchMedia("(prefers-color-scheme: dark)").matches ? "dark" : "light";
                        // Salva como 'auto' no storage para lógica futura, mas aplica o visual agora
                        localStorage.setItem("karteria-theme-preference", "auto");
                    }

                    if (document.getElementById("themeDevice").checked) {
                        localStorage.removeItem("karteria-theme"); 
                        window.location.reload(); 
                    } else {
                        window.Karteria.theme.set(selectedTheme);
                    }
                });
            });
        </script>
    </body>
</html>

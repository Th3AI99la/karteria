<!doctype html>
<html lang="pt-br" xmlns:th="http://www.thymeleaf.org" data-bs-theme="dark">
    <head>
        <meta charset="UTF-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />
        <title th:text="${anuncio.id == null ? 'Publicar Nova Vaga' : 'Editar Vaga'}">Formulário de Anúncio</title>

        <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" />
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css" />
        <link rel="stylesheet" th:href="@{/css/karteria-colors.css}" />
        <link rel="stylesheet" th:href="@{/css/karteria-main.css}" />
        <link rel="stylesheet" th:href="@{/css/fragments/_navbar_dashboard.css}" />
        <link href="https://unpkg.com/aos@2.3.1/dist/aos.css" rel="stylesheet" />
    </head>

    <body data-bs-theme="dark">
        <nav class="navbar navbar-expand-lg navbar-modern fixed-top">
            <div class="container-fluid">
                <a class="navbar-brand-modern brand-text" th:href="@{/home}">
                    <i class="fas fa-handshake me-2"></i>
                    Karteria
                </a>
                <div class="ms-auto d-flex align-items-center">
                    <button class="theme-toggle" id="themeToggle">
                        <i class="fas fa-moon" id="themeIcon"></i>
                    </button>
                    <form th:action="@{/logout}" method="post" class="ms-2">
                        <button type="submit" class="btn btn-outline-danger">Sair</button>
                    </form>
                </div>
            </div>
        </nav>

        <div class="container" style="padding-top: 100px">
            <div class="row justify-content-center">
                <div class="col-lg-8" data-aos="fade-up">
                    <div class="card-modern">
                        <div class="card-body p-4 p-md-5">
                            <div class="text-center mb-4">
                                <h2 class="section-title" th:text="${anuncio.id == null ? 'Detalhes da Nova Vaga' : 'Editando Vaga'}"></h2>
                            </div>

                            <form th:action="@{/anuncios/salvar}" th:object="${anuncio}" method="post">
                                <input type="hidden" th:field="*{id}" />

                                <div class="mb-3">
                                    <label for="tituloVaga" class="form-label">Título da Vaga *</label>
                                    <input type="text" th:field="*{titulo}" id="tituloVaga" class="form-control form-control-lg" required />
                                </div>

                                <div class="mb-3">
                                    <label for="descricaoVaga" class="form-label">Descrição Detalhada *</label>
                                    <textarea th:field="*{descricao}" id="descricaoVaga" class="form-control" rows="5" required></textarea>
                                </div>

                                <div class="mb-3 p-3" style="background: var(--bg-tertiary); border-radius: var(--radius-md)">
                                    <label for="tipoPagamentoSelect" class="form-label d-block">Valor Oferecido (R$) *</label>

                                    <div class="mb-3">
                                        <label class="form-label small">Tipo de Pagamento</label>
                                        <select th:field="*{tipoPagamento}" class="form-select" required id="tipoPagamentoSelect">
                                            <option value="" disabled>Selecione...</option>
                                            <option value="POR_HORA">Por Hora</option>
                                            <option value="POR_DIA">Por Dia</option>
                                            <option value="UNICO">Valor Único (Total)</option>
                                        </select>
                                    </div>

                                    <div class="row" id="valorIntervaloGroup" style="display: none">
                                        <div class="col-md-6">
                                            <label for="valorMin" class="form-label small">Valor Mínimo (Ex: 40)</label>
                                            <input type="number" th:field="*{valorMin}" id="valorMin" class="form-control" step="0.01" placeholder="40" />
                                        </div>
                                        <div class="col-md-6">
                                            <label for="valorMax" class="form-label small">Valor Máximo (Ex: 80) (Opcional)</label>
                                            <input type="number" th:field="*{valorMax}" id="valorMax" class="form-control" step="0.01" placeholder="80" />
                                        </div>
                                    </div>

                                    <div id="valorUnicoGroup" style="display: none">
                                        <label for="valorUnico" class="form-label small">Valor Único (Ex: 500)</label>
                                        <input type="number" th:field="*{valorMin}" id="valorUnico" class="form-control" step="0.01" placeholder="500" />
                                    </div>

                                    <small class="form-text text-muted" id="valorHelpText" style="display: none">Para valor fixo (Ex: R$50/dia), preencha só o Mínimo.</small>
                                </div>

                                <div class="mb-3">
                                    <label for="localizacao" class="form-label">Localização (Bairro, Cidade) *</label>
                                    <input type="text" th:field="*{localizacao}" id="localizacao" class="form-control" required />
                                    <small class="form-text text-muted">Pré-preenchido com base no seu perfil. Você pode editar.</small>
                                </div>

                                <hr class="my-4" />

                                <div class="form-check form-switch mb-3">
                                    <input class="form-check-input" type="checkbox" role="switch" id="exibirTelefone" th:field="*{exibirTelefone}" />
                                    <label class="form-check-label" for="exibirTelefone">Exibir meu telefone na publicação</label>
                                    <div class="form-text text-muted small">Se marcado, seu telefone (do perfil) ficará visível para todos.</div>
                                </div>

                                <div class="form-check form-switch mb-3">
                                    <input class="form-check-input" type="checkbox" role="switch" id="permitirContato" th:field="*{permitirContato}" />
                                    <label class="form-check-label" for="permitirContato">Permitir que usuários entrem em contato comigo</label>
                                    <div class="form-text text-muted small" id="permitirContatoHelp">
                                        Se desmarcado, você (empregador) deverá iniciar o contato com os candidatos.
                                    </div>
                                </div>

                                <div class="d-flex justify-content-end align-items-center mt-4 gap-2">
                                    <a th:href="@{/home}" class="btn btn-secondary">Cancelar</a>
                                    <button type="submit" class="btn btn-primary-karteria btn-lg">
                                        <i th:classappend="${anuncio.id == null ? 'fas fa-check' : 'fas fa-save'}" class="me-2"></i>
                                        <span th:text="${anuncio.id == null ? 'Publicar Vaga' : 'Salvar Alterações'}"></span>
                                    </button>
                                </div>
                            </form>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
        <script src="https://unpkg.com/aos@2.3.1/dist/aos.js"></script>
        <script th:src="@{/js/karteria-main.js}"></script>
        <script th:src="@{/js/form-masks-validations.js}"></script>

        <script>
            AOS.init({ once: true, duration: 600 });

            // Executa quando o DOM estiver pronto
            document.addEventListener("DOMContentLoaded", () => {
                // --- 1. LÓGICA DE CAPITALIZAÇÃO (TÍTULO E DESCRIÇÃO) ---
                // (Esta parte permanece a mesma)
                try {
                    if (typeof capitalizeFirstLetter === "function") {
                        capitalizeFirstLetter(document.getElementById("tituloVaga"));
                        capitalizeFirstLetter(document.getElementById("descricaoVaga"));
                    } else {
                        console.warn("Função capitalizeFirstLetter() não encontrada.");
                    }
                } catch (e) {
                    console.error("Erro na capitalização:", e);
                }

                // --- 2. LÓGICA DO TIPO DE PAGAMENTO (VALOR) ---
                // (Esta parte permanece a mesma)
                const tipoPagamentoSelect = document.getElementById("tipoPagamentoSelect");
                const valorIntervaloGroup = document.getElementById("valorIntervaloGroup");
                const valorUnicoGroup = document.getElementById("valorUnicoGroup");
                const valorHelpText = document.getElementById("valorHelpText");

                const valorMinInput = document.getElementById("valorMin");
                const valorMaxInput = document.getElementById("valorMax");
                const valorUnicoInput = document.getElementById("valorUnico");

                function atualizarCamposValor() {
                    const tipo = tipoPagamentoSelect.value;
                    valorIntervaloGroup.style.display = "none";
                    valorUnicoGroup.style.display = "none";
                    valorHelpText.style.display = "none";

                    if (tipo === "POR_HORA" || tipo === "POR_DIA") {
                        valorIntervaloGroup.style.display = "flex";
                        valorHelpText.style.display = "block";
                        valorUnicoInput.value = "";
                    } else if (tipo === "UNICO") {
                        valorUnicoGroup.style.display = "block";
                        valorMinInput.value = "";
                        valorMaxInput.value = "";
                    }
                }
                tipoPagamentoSelect.addEventListener("change", atualizarCamposValor);
                atualizarCamposValor();

                // --- 3. LÓGICA DOS TOGGLES (CONTATO) - REVISADA ---
                // (Esta é a nova lógica que você pediu)

                const toggleTelefone = document.getElementById("exibirTelefone"); // Toggle de Cima
                const toggleContato = document.getElementById("permitirContato"); // Toggle de Baixo

                // Função 1: O que acontece quando mexe no toggle de CIMA (Telefone)
                function logicaToggleTelefone() {
                    if (toggleTelefone.checked) {
                        // Se eu marco "Exibir Telefone" (Cima),
                        // eu *automaticamente* tenho que permitir contato (Baixo).
                        toggleContato.checked = true;
                    }
                }

                // Função 2: O que acontece quando mexe no toggle de BAIXO (Contato)
                function logicaToggleContato() {
                    if (!toggleContato.checked) {
                        // Se eu desmarco "Permitir Contato" (Baixo),
                        // eu *automaticamente* devo parar de exibir meu telefone (Cima).
                        // (Esta é a lógica que você solicitou)
                        toggleTelefone.checked = false;
                    }
                }

                // Adiciona os "ouvintes"
                toggleTelefone.addEventListener("change", logicaToggleTelefone);
                toggleContato.addEventListener("change", logicaToggleContato);

                // Executa a lógica uma vez no carregamento para garantir
                // que o estado inicial (vindo do banco) seja consistente
                logicaToggleContato();
                logicaToggleTelefone();
            });
        </script>
    </body>
</html>
